---
// src/pages/admin/index.astro - FIXED Server-Safe
// Don't run auth on server-side, handle it client-side
---

<html>
  <head>
    <meta charset="UTF-8" />
    <title>Admin Redirect</title>
  </head>
  <body>
    <div id="loading">Loading admin...</div>

    <script>
      // Handle auth client-side only
      import { adminAuthManager } from "../../lib/admin/auth.js";

      document.addEventListener("DOMContentLoaded", async () => {
        try {
          await adminAuthManager.initialize();
          const user = await adminAuthManager.getCurrentUser();

          if (!user) {
            window.location.href = "/auth/admin-signin";
            return;
          }

          // Check if this is TinaCMS access
          const urlParams = new URLSearchParams(window.location.search);
          if (urlParams.get("cms") === "true") {
            window.location.href = "/admin/index.html";
            return;
          }

          // Default redirect to dashboard
          window.location.href = "/admin/dashboard";
        } catch (error) {
          console.error("Admin auth failed:", error);
          window.location.href = "/auth/admin-signin";
        }
      });
    </script>
  </body>
</html>
