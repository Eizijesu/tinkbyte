---
import { getCollection } from "astro:content";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import AuthorBio from "../../../components/blog/AuthorBio.astro";

interface Author {
  slug: string;
  name: string;
  bio?: string;
  avatar?: string;
  role?: string;
  social?: {
    twitter?: string;
    linkedin?: string;
    website?: string;
    github?: string;
  };
}

export async function getStaticPaths() {
  const authors = await getCollection("authors");
  return authors.map((author) => ({
    params: { author: author.slug },
    props: { author: author.data },
  }));
}

const { author } = Astro.props as { author: Author };

const authorWithDefaults: Author = {
  name: author.name,
  bio: author.bio ?? "",
  avatar: author.avatar ?? "/default-avatar.png",
  role: author.role ?? "",
  social: author.social ?? {},
  slug: author.slug,
};
---

<BaseLayout title={`Author: ${authorWithDefaults.name}`}>
  <div class="max-w-3xl mx-auto px-4 sm:px-6 py-16">
    <AuthorBio author={authorWithDefaults} />

    <h2 class="text-2xl font-bold mt-12 mb-8">Recent Articles</h2>
    <div class="space-y-6">
      {
        (await getCollection("blog"))
          .filter((post) => post.data.author === author.slug)
          .map((post) => (
            <a href={`/blog/${post.slug}`} class="block group">
              <h3 class="text-lg font-semibold group-hover:text-primary transition">
                {post.data.title}
              </h3>
              <p class="text-sm text-zinc-600 dark:text-zinc-400 mt-1">
                {post.data.pubDate.toLocaleDateString()}
              </p>
            </a>
          ))
      }
    </div>
  </div>
</BaseLayout>
