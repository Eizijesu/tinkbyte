---
// src/pages/blog/[slug].astro - COMPLETE REPLACEMENT
import { type CollectionEntry, getCollection } from "astro:content";
import BlogPost from "../../layouts/BlogPost.astro";

export async function getStaticPaths() {
  // Get all blog posts from content collection
  const posts = await getCollection("blog", ({ data }) => {
    return data.draft !== true;
  });

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

type Props = CollectionEntry<"blog">;

const post = Astro.props;
const { Content } = await post.render();

// Format date for display
const formatDate = (date: Date): string => {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
};
---

<BlogPost
  title={post.data.title}
  subtitle={post.data.subtitle}
  description={post.data.excerpt || post.data.description}
  date={formatDate(post.data.pubDate)}
  readTime={post.data.readTime}
  tags={post.data.tags}
  category={post.data.category}
  author={post.data.author}
  authorBio={post.data.authorBio}
  authorAvatar={post.data.authorAvatar}
  authorRole={post.data.authorRole}
  audioUrl={post.data.audioUrl}
  audioDuration={post.data.audioDuration}
  image={post.data.image}
  slug={post.slug}
>
  <!-- This renders the actual markdown content from your .md files -->
  <Content />
</BlogPost>
