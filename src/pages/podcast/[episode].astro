---
import Layout from "../../layouts/Layout.astro";
import AudioPlayer from "../../components/ui/AudioPlayer.astro";
import ShareButtons from "../../components/ui/ShareButtons.astro";

export async function getStaticPaths() {
  // In real implementation, this would fetch from your CMS
  return [
    {
      params: { episode: "ai-evolution-beyond-hype" },
      props: {
        episode: {
          title: "AI Evolution: Beyond the Hype Cycle",
          description:
            "A deep dive into practical AI implementation with Dr. Elena Vasquez, exploring what actually works when you strip away the marketing buzz and focus on delivering real value.",
          audioUrl: "/audio/ai-evolution-beyond-hype.mp3",
          duration: "28:45",
          publishDate: "2024-01-25",
          slug: "ai-evolution-beyond-hype",
          image:
            "https://images.unsplash.com/photo-1677442136019-21780ecad995?w=1200&h=800&fit=crop",
          host: "TinkByte Team",
          guest: {
            name: "Dr. Elena Vasquez",
            bio: "AI researcher turned product strategist with 12+ years in machine learning",
            avatar:
              "https://images.unsplash.com/photo-1580489944761-15a19d654956?w=100&h=100&fit=crop&crop=face",
            role: "Chief AI Officer",
            social: {
              twitter: "https://twitter.com/elenavasquez",
              linkedin: "https://linkedin.com/in/elenavasquez",
            },
          },
          tags: ["AI", "Product Strategy", "Implementation"],
          transcript: `
            [00:00] Welcome to TinkByte Audio. I'm here with Dr. Elena Vasquez...
            [00:30] Elena, let's start with the reality check about AI implementation...
            [01:15] The gap between AI marketing and AI reality is wider than most people realize...
            [02:00] What are the three characteristics of successful AI implementations?...
            [Continue with full transcript...]
          `,
          showNotes: [
            {
              timestamp: "00:00",
              title: "Introduction",
              description: "Welcome and guest introduction",
            },
            {
              timestamp: "02:00",
              title: "AI Reality Check",
              description: "The gap between marketing and reality",
            },
            {
              timestamp: "05:30",
              title: "Success Characteristics",
              description: "Three traits of successful AI implementations",
            },
            {
              timestamp: "12:15",
              title: "E-commerce Case Study",
              description: "Real-world recommendation engine example",
            },
            {
              timestamp: "20:00",
              title: "Implementation Framework",
              description: "Practical framework for AI adoption",
            },
            {
              timestamp: "25:30",
              title: "Common Pitfalls",
              description: "Mistakes to avoid in AI projects",
            },
          ],
        },
      },
    },
    // Add more episodes...
  ];
}

const { episode } = Astro.props;

// Create a mock current post object for RelatedPosts component
const currentPost = {
  slug: episode.slug,
  data: {
    title: episode.title,
    category: "Audio",
    tags: episode.tags,
    pubDate: new Date(episode.publishDate),
  },
};

// Convert related episodes to blog post format for RelatedPosts component
const relatedEpisodes = [
  {
    slug: "building-products-scale-globally",
    data: {
      title: "Building Products That Scale Globally",
      excerpt: "Lessons from the trenches of global product development.",
      pubDate: new Date("2024-01-22"),
      category: "Product Strategy",
      tags: ["product-strategy", "scaling"],
      author: "Alex Chen",
      authorAvatar:
        "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face",
      authorRole: "Senior Product Manager",
      image:
        "https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400&h=300&fit=crop",
      featured: false,
      readTime: "35 min listen",
    },
  },
  {
    slug: "human-side-tech-culture",
    data: {
      title: "The Human Side of Tech Culture",
      excerpt: "Building sustainable technology organizations.",
      pubDate: new Date("2024-01-20"),
      category: "Tech Culture",
      tags: ["tech-culture", "team-building"],
      author: "Sarah Kim",
      authorAvatar:
        "https://images.unsplash.com/photo-1494790108755-2616b612b47c?w=100&h=100&fit=crop&crop=face",
      authorRole: "Culture Analyst",
      image:
        "https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=400&h=300&fit=crop",
      featured: false,
      readTime: "22 min listen",
    },
  },
];
---

<Layout
  title={`${episode.title} | TinkByte Audio`}
  description={episode.description}
  image={episode.image}
  type="article"
  publishedTime={new Date(episode.publishDate).toISOString()}
  author={episode.guest.name}
  tags={episode.tags}
>
  <!-- Episode Header -->
  <article class="max-w-4xl mx-auto px-4 sm:px-6 py-12">
    <!-- Episode Meta -->
    <header class="mb-8">
      <!-- Breadcrumb -->
      <nav class="mb-6">
        <ol
          class="flex items-center space-x-2 text-sm text-zinc-500 dark:text-zinc-400"
        >
          <li>
            <a
              href="/audio"
              class="hover:text-zinc-700 dark:hover:text-zinc-300 uppercase tracking-wide"
              >Audio</a
            >
          </li>
          <li><i class="fas fa-chevron-right text-xs"></i></li>
          <li class="text-zinc-700 dark:text-zinc-300 uppercase tracking-wide">
            Episode
          </li>
        </ol>
      </nav>

      <!-- Episode Badge -->
      <div class="mb-4">
        <span
          class="inline-flex items-center px-3 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-300 rounded-full text-sm font-medium uppercase tracking-wide"
        >
          <i class="fas fa-headphones mr-2"></i>
          Audio Episode
        </span>
      </div>

      <!-- Title -->
      <h1
        class="text-3xl sm:text-4xl lg:text-5xl font-bold text-zinc-900 dark:text-zinc-100 mb-6 leading-tight"
      >
        {episode.title}
      </h1>

      <!-- Episode Meta Info -->
      <div
        class="flex flex-wrap items-center gap-4 text-sm text-zinc-500 dark:text-zinc-400 mb-6"
      >
        <time datetime={episode.publishDate}>
          {
            new Date(episode.publishDate).toLocaleDateString("en-US", {
              month: "long",
              day: "numeric",
              year: "numeric",
            })
          }
        </time>
        <span class="w-1 h-1 bg-zinc-400 rounded-full"></span>
        <span class="flex items-center gap-1">
          <i class="fas fa-clock"></i>
          {episode.duration}
        </span>
        <span class="w-1 h-1 bg-zinc-400 rounded-full"></span>
        <span class="flex items-center gap-1">
          <i class="fas fa-download"></i>
          Download Available
        </span>
      </div>

      <!-- Host & Guest Info -->
      <div class="bg-zinc-50 dark:bg-zinc-800/50 rounded-sm p-6 mb-8">
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Host -->
          <div>
            <h3
              class="text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-2 uppercase tracking-wide"
            >
              Hosted by
            </h3>
            <p class="text-zinc-900 dark:text-zinc-100 font-medium">
              {episode.host}
            </p>
          </div>

          <!-- Guest -->
          <div>
            <h3
              class="text-sm font-semibold text-zinc-700 dark:text-zinc-300 mb-2 uppercase tracking-wide"
            >
              Featuring
            </h3>
            <div class="flex items-center gap-3">
              <img
                src={episode.guest.avatar}
                alt={episode.guest.name}
                class="w-10 h-10 rounded-full"
                loading="lazy"
              />
              <div>
                <p class="text-zinc-900 dark:text-zinc-100 font-medium">
                  {episode.guest.name}
                </p>
                <p class="text-sm text-zinc-600 dark:text-zinc-400">
                  {episode.guest.role}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Episode Image -->
    <div class="aspect-[16/9] overflow-hidden rounded-sm mb-8">
      <img
        src={episode.image}
        alt={episode.title}
        class="w-full h-full object-cover"
        loading="eager"
      />
    </div>

    <!-- Audio Player -->
    <div class="mb-8">
      <AudioPlayer
        audioUrl={episode.audioUrl}
        title={episode.title}
        duration={episode.duration}
        transcript={episode.transcript}
        downloadUrl={episode.audioUrl}
      />
    </div>

    <!-- Episode Description -->
    <div class="prose prose-lg prose-zinc dark:prose-invert max-w-none mb-8">
      <p class="text-xl leading-relaxed">
        {episode.description}
      </p>
    </div>

    <!-- Show Notes -->
    {
      episode.showNotes && (
        <section class="mb-8">
          <h2 class="text-2xl font-bold text-zinc-900 dark:text-zinc-100 mb-6 uppercase tracking-wide">
            Show Notes
          </h2>
          <div class="bg-white dark:bg-zinc-900 rounded-sm border border-zinc-200 dark:border-zinc-800 p-6">
            <div class="space-y-4">
              {episode.showNotes.map((note) => (
                <div class="flex gap-4 group">
                  <div class="flex-shrink-0">
                    <span class="inline-block px-2 py-1 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 text-sm font-mono rounded">
                      {note.timestamp}
                    </span>
                  </div>
                  <div class="flex-1">
                    <h3 class="font-semibold text-zinc-900 dark:text-zinc-100 mb-1">
                      {note.title}
                    </h3>
                    <p class="text-zinc-600 dark:text-zinc-400 text-sm">
                      {note.description}
                    </p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>
      )
    }

    <!-- Transcript -->
    {
      episode.transcript && (
        <section class="mb-8">
          <h2 class="text-2xl font-bold text-zinc-900 dark:text-zinc-100 mb-6 uppercase tracking-wide">
            Transcript
          </h2>
          <details class="bg-white dark:bg-zinc-900 rounded-sm border border-zinc-200 dark:border-zinc-800">
            <summary class="p-6 cursor-pointer font-medium text-zinc-900 dark:text-zinc-100 hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors">
              <span class="uppercase tracking-wide">Show Full Transcript</span>
            </summary>
            <div class="px-6 pb-6">
              <div class="prose prose-sm prose-zinc dark:prose-invert max-w-none">
                <pre class="whitespace-pre-wrap font-sans text-sm leading-relaxed">
                  {episode.transcript}
                </pre>
              </div>
            </div>
          </details>
        </section>
      )
    }

    <!-- Tags -->
    <div class="flex flex-wrap gap-2 mb-8">
      <span
        class="text-sm font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide"
      >
        Tags:
      </span>
      {
        episode.tags.map((tag) => (
          <a
            href={`/audio/tag/${tag.toLowerCase().replace(/\s+/g, "-")}`}
            class="px-3 py-1 bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 text-sm rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors uppercase tracking-wide"
          >
            #{tag}
          </a>
        ))
      }
    </div>

    <!-- Share Buttons -->
    <div class="border-t border-zinc-200 dark:border-zinc-800 pt-8 mb-8">
      <ShareButtons
        title={episode.title}
        url={`/audio/${episode.slug}`}
        description={episode.description}
      />
    </div>

    <!-- Guest Bio -->
    <section class="bg-zinc-50 dark:bg-zinc-800/50 rounded-sm p-6 mb-8">
      <h2
        class="text-xl font-bold text-zinc-900 dark:text-zinc-100 mb-4 uppercase tracking-wide"
      >
        About the Guest
      </h2>
      <div class="flex items-start gap-4">
        <img
          src={episode.guest.avatar}
          alt={episode.guest.name}
          class="w-16 h-16 rounded-full flex-shrink-0"
          loading="lazy"
        />
        <div class="flex-1">
          <h3
            class="text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-1"
          >
            {episode.guest.name}
          </h3>
          <p
            class="text-sm text-zinc-600 dark:text-zinc-400 mb-3 uppercase tracking-wide"
          >
            {episode.guest.role}
          </p>
          <p class="text-zinc-700 dark:text-zinc-300 mb-4 leading-relaxed">
            {episode.guest.bio}
          </p>
          {
            episode.guest.social && (
              <div class="flex gap-3">
                {episode.guest.social.twitter && (
                  <a
                    href={episode.guest.social.twitter}
                    class="text-zinc-500 hover:text-blue-500 transition-colors"
                    target="_blank"
                    rel="noopener noreferrer"
                    aria-label="Twitter"
                  >
                    <i class="fab fa-twitter" />
                  </a>
                )}
                {episode.guest.social.linkedin && (
                  <a
                    href={episode.guest.social.linkedin}
                    class="text-zinc-500 hover:text-blue-600 transition-colors"
                    target="_blank"
                    rel="noopener noreferrer"
                    aria-label="LinkedIn"
                  >
                    <i class="fab fa-linkedin" />
                  </a>
                )}
              </div>
            )
          }
        </div>
      </div>
    </section>
  </article>

  <!-- Related Episodes Section -->
  <section class="py-16 px-4 sm:px-6 bg-zinc-50 dark:bg-zinc-900/50">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-zinc-900 dark:text-zinc-100 mb-4">
          Related Episodes
        </h2>
        <p class="text-xl text-zinc-600 dark:text-zinc-400">
          More episodes you might like
        </p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          relatedEpisodes.map((relatedEpisode) => (
            <article class="bg-white dark:bg-zinc-800 rounded-sm border border-zinc-200 dark:border-zinc-700 overflow-hidden hover:shadow-lg transition-shadow">
              <div class="aspect-[16/9] overflow-hidden">
                <img
                  src={relatedEpisode.data.image}
                  alt={relatedEpisode.data.title}
                  class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  loading="lazy"
                />
              </div>
              <div class="p-6">
                <div class="flex items-center gap-2 mb-3 text-xs text-zinc-500 dark:text-zinc-400">
                  <time datetime={relatedEpisode.data.pubDate.toISOString()}>
                    {relatedEpisode.data.pubDate.toLocaleDateString("en-US", {
                      month: "long",
                      day: "numeric",
                      year: "numeric",
                    })}
                  </time>
                  <span class="w-1 h-1 bg-zinc-400 rounded-full" />
                  <span>{relatedEpisode.data.readTime}</span>
                </div>
                <h3 class="text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2 leading-tight">
                  <a
                    href={`/podcast/${relatedEpisode.slug}`}
                    class="hover:text-zinc-700 dark:hover:text-zinc-300 transition-colors"
                  >
                    {relatedEpisode.data.title}
                  </a>
                </h3>
                <p class="text-sm text-zinc-600 dark:text-zinc-400 mb-4 line-clamp-2">
                  {relatedEpisode.data.excerpt}
                </p>
                <div class="flex items-center gap-3">
                  <img
                    src={relatedEpisode.data.authorAvatar}
                    alt={relatedEpisode.data.author}
                    class="w-8 h-8 rounded-full"
                    loading="lazy"
                  />
                  <div>
                    <div class="text-sm font-medium text-zinc-900 dark:text-zinc-100">
                      {relatedEpisode.data.author}
                    </div>
                    <div class="text-xs text-zinc-500 dark:text-zinc-400">
                      {relatedEpisode.data.authorRole}
                    </div>
                  </div>
                </div>
              </div>
            </article>
          ))
        }
      </div>
    </div>
  </section>
</Layout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
